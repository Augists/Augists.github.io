<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/32.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/16.ico">
  <link rel="mask-icon" href="/images/32.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"augists.top","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

<script>
  (function() {
    if ('') {
      if (prompt('Please input password') !== '') {
        alert('Wrong password! ');
        history.back();
      }
    }
  })();
</script>

  <meta name="description" content="Analysis of AODV protocol based on its source code">
<meta property="og:type" content="article">
<meta property="og:title" content="AODV Analysis">
<meta property="og:url" content="https://augists.top/SELF/SHARING/STUDY/AODV-Source-Code-Analysis/index.html">
<meta property="og:site_name" content="Augists-ZDCZ">
<meta property="og:description" content="Analysis of AODV protocol based on its source code">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s2.loli.net/2021/12/12/ZitwIevknBAWyQ6.jpg">
<meta property="article:published_time" content="2022-01-03T15:26:34.000Z">
<meta property="article:modified_time" content="2022-01-03T15:31:07.219Z">
<meta property="article:author" content="Augists">
<meta property="article:tag" content="SHARING">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2021/12/12/ZitwIevknBAWyQ6.jpg">

<link rel="canonical" href="https://augists.top/SELF/SHARING/STUDY/AODV-Source-Code-Analysis/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>AODV Analysis | Augists-ZDCZ</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Augists-ZDCZ" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

	<!-- github icon -->
	<a target="_blank" rel="noopener" href="https://github.com/Augists" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Augists-ZDCZ</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">LESS is MORE</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-gallery">

    <a href="/gallery/" rel="section"><i class="fas fa-images fa-fw"></i>Gallery</a>

  </li>
        <li class="menu-item menu-item-f-links">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>F-links</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://augists.top/SELF/SHARING/STUDY/AODV-Source-Code-Analysis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://augists-upic.oss-cn-qingdao.aliyuncs.com/uPic/2CCC8E38-15C8-4A70-A836-2DC4D988DD4E_1_105_c.jpeg">
      <meta itemprop="name" content="Augists">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Augists-ZDCZ">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          AODV Analysis
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-01-03 23:26:34 / Modified: 23:31:07" itemprop="dateCreated datePublished" datetime="2022-01-03T23:26:34+08:00">2022-01-03</time>
            </span>

          
            <div class="post-description">Analysis of AODV protocol based on its source code</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <div class="note warning">
            <h1 id="AODV-åè®®åŸºæœ¬åŸç†åŠå·¥ä½œæµç¨‹"><a href="#AODV-åè®®åŸºæœ¬åŸç†åŠå·¥ä½œæµç¨‹" class="headerlink" title="AODV åè®®åŸºæœ¬åŸç†åŠå·¥ä½œæµç¨‹"></a>AODV åè®®åŸºæœ¬åŸç†åŠå·¥ä½œæµç¨‹</h1><h2 id="AODV-ç®€ä»‹"><a href="#AODV-ç®€ä»‹" class="headerlink" title="AODV ç®€ä»‹"></a>AODV ç®€ä»‹</h2><blockquote><p>The Ad hoc On-Demand Distance Vector (AODV) algorithm enables<br>dynamic, self-starting, multihop routing between participating mobile<br>nodes wishing to establish and maintain an ad hoc network.  AODV<br>allows mobile nodes to obtain routes quickly for new destinations,<br>and does not require nodes to maintain routes to destinations that<br>are not in active communication.  AODV allows mobile nodes to respond<br>to link breakages and changes in network topology in a timely manner.<br>The operation of AODV is loop-free, and by avoiding the Bellman-Ford<br>â€œcounting to infinityâ€ problem offers quick convergence when the ad<br>hoc network topology changes (typically, when a node moves in the<br>network).  When links break, AODV causes the affected set of nodes to<br>be notified so that they are able to invalidate the routes using the<br>lost link.</p></blockquote><p>One distinguishing feature of AODV is its use of a destination<br>sequence number for each route entry.  The destination sequence<br>number is created by the destination to be included along with any<br>route information it sends to requesting nodes.  Using destination<br>sequence numbers ensures loop freedom and is simple to program.<br>Given the choice between two routes to a destination, a requesting<br>node is required to select the one with the greatest sequence number.</p><p>AODV uses the following fields with each route table entry:</p><ul><li>Destination IP Address</li><li>Destination Sequence Number</li><li>Valid Destination Sequence Number flag</li><li>Other state and routing flags (e.g., valid, invalid, repairable, being repaired)</li><li>Network Interface</li><li>Hop Count (number of hops needed to reach destination)</li><li>Next Hop</li><li>List of Precursors (described in Section 6.2)</li><li>Lifetime (expiration or deletion time of the route)</li></ul><hr><h2 id="AODV-ç‰¹ç‚¹"><a href="#AODV-ç‰¹ç‚¹" class="headerlink" title="AODV ç‰¹ç‚¹"></a>AODV ç‰¹ç‚¹</h2><ul><li>æ¥å…¥é€Ÿåº¦å¿«</li><li>è®¡ç®—é‡å°</li><li>å†…å­˜å ç”¨ä½</li><li>ç½‘ç»œè´Ÿè½½è½»</li></ul><p>ç–‘é—®ğŸ¤”ï¸ï¼šAODV åè®®é€šè¿‡ç®¡ç† sequence number æ¥åœ¨æœ‰å¤šä¸ªæœ‰æ•ˆè·¯ç”±çš„æƒ…å†µä¸‹è¿›è¡Œå†³ç­–ï¼Œæ¯ä½¿ç”¨è¿‡ä¸€æ¬¡ sequence number+1ï¼Œå¹¶ä»¥æ­¤æ¥è¡¨ç¤ºèŠ‚ç‚¹çš„æ–°é²œç¨‹åº¦ï¼Œé€‰æ‹© sequence number è¾ƒå¤§çš„æœ‰æ•ˆè·¯ç”±ã€‚è¿™æ ·éš¾é“ä¸ä¼šå¯¼è‡´ç§¯å‹ã€å¢å¤§è´Ÿè½½å—ï¼Ÿæ„Ÿè§‰å¹¶ä¸æ˜¯ä¸€ä¸ªåˆç†çš„æ–¹æ¡ˆ</p><hr><h2 id="AODV-Message-Type"><a href="#AODV-Message-Type" class="headerlink" title="AODV Message Type"></a>AODV Message Type</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* AODV Message types */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> AODV_HELLO 0 <span class="comment">/* Really never used as a separate type... */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> AODV_RREQ 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> AODV_RREP 2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> AODV_RERR 3</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> AODV_RREP_ACK 4</span></span><br></pre></td></tr></table></figure><hr><h2 id="AODV-æ–‡ä»¶æ ‘åˆ†æ"><a href="#AODV-æ–‡ä»¶æ ‘åˆ†æ" class="headerlink" title="AODV æ–‡ä»¶æ ‘åˆ†æ"></a>AODV æ–‡ä»¶æ ‘åˆ†æ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ ChangeLog</span><br><span class="line">â”œâ”€â”€ GPL</span><br><span class="line">â”œâ”€â”€ Makefile</span><br><span class="line">â”œâ”€â”€ README</span><br><span class="line">â”œâ”€â”€ README.ns</span><br><span class="line">â”œâ”€â”€ TODO</span><br><span class="line">â”œâ”€â”€ aodv_hello.c</span><br><span class="line">â”œâ”€â”€ aodv_hello.h</span><br><span class="line">â”œâ”€â”€ aodv_neighbor.c</span><br><span class="line">â”œâ”€â”€ aodv_neighbor.h</span><br><span class="line">â”œâ”€â”€ aodv_rerr.c</span><br><span class="line">â”œâ”€â”€ aodv_rerr.h</span><br><span class="line">â”œâ”€â”€ aodv_rrep.c</span><br><span class="line">â”œâ”€â”€ aodv_rrep.h</span><br><span class="line">â”œâ”€â”€ aodv_rreq.c</span><br><span class="line">â”œâ”€â”€ aodv_rreq.h</span><br><span class="line">â”œâ”€â”€ aodv_socket.c</span><br><span class="line">â”œâ”€â”€ aodv_socket.h</span><br><span class="line">â”œâ”€â”€ aodv_timeout.c</span><br><span class="line">â”œâ”€â”€ aodv_timeout.h</span><br><span class="line">â”œâ”€â”€ debug.c</span><br><span class="line">â”œâ”€â”€ debug.h</span><br><span class="line">â”œâ”€â”€ defs.h</span><br><span class="line">â”œâ”€â”€ endian.c</span><br><span class="line">â”œâ”€â”€ list.c</span><br><span class="line">â”œâ”€â”€ list.h</span><br><span class="line">â”œâ”€â”€ llf.c</span><br><span class="line">â”œâ”€â”€ llf.h</span><br><span class="line">â”œâ”€â”€ lnx</span><br><span class="line">â”‚   â”œâ”€â”€ Makefile</span><br><span class="line">â”‚   â”œâ”€â”€ TAGS</span><br><span class="line">â”‚   â”œâ”€â”€ kaodv-debug.c</span><br><span class="line">â”‚   â”œâ”€â”€ kaodv-debug.h</span><br><span class="line">â”‚   â”œâ”€â”€ kaodv-expl.c</span><br><span class="line">â”‚   â”œâ”€â”€ kaodv-expl.h</span><br><span class="line">â”‚   â”œâ”€â”€ kaodv-ipenc.c</span><br><span class="line">â”‚   â”œâ”€â”€ kaodv-ipenc.h</span><br><span class="line">â”‚   â”œâ”€â”€ kaodv-mod.c</span><br><span class="line">â”‚   â”œâ”€â”€ kaodv-mod.h</span><br><span class="line">â”‚   â”œâ”€â”€ kaodv-netlink.c</span><br><span class="line">â”‚   â”œâ”€â”€ kaodv-netlink.h</span><br><span class="line">â”‚   â”œâ”€â”€ kaodv-queue.c</span><br><span class="line">â”‚   â”œâ”€â”€ kaodv-queue.h</span><br><span class="line">â”‚   â””â”€â”€ kaodv.h</span><br><span class="line">â”œâ”€â”€ locality.c</span><br><span class="line">â”œâ”€â”€ locality.h</span><br><span class="line">â”œâ”€â”€ main.c</span><br><span class="line">â”œâ”€â”€ nl.c</span><br><span class="line">â”œâ”€â”€ nl.h</span><br><span class="line">â”œâ”€â”€ params.h</span><br><span class="line">â”œâ”€â”€ patches</span><br><span class="line">â”‚   â”œâ”€â”€ ns-2.26-aodv-uu-0.8.patch</span><br><span class="line">â”‚   â”œâ”€â”€ ns-2.27-aodv-uu-0.8.patch</span><br><span class="line">â”‚   â”œâ”€â”€ ns-2.27-aodv-uu-0.9.1.patch</span><br><span class="line">â”‚   â”œâ”€â”€ ns-2.27-aodv-uu-0.9.patch</span><br><span class="line">â”‚   â”œâ”€â”€ ns-2.28-aodv-uu-0.9.1.patch</span><br><span class="line">â”‚   â”œâ”€â”€ ns-2.29-aodv-uu-0.9.1-dsr-uu-0.2-oolsr-0.99.15.patch</span><br><span class="line">â”‚   â”œâ”€â”€ ns-2.29.3-aodv-uu-0.9.2.patch</span><br><span class="line">â”‚   â””â”€â”€ ns-2.32-aodv-uu.patch</span><br><span class="line">â”œâ”€â”€ rfc3561.txt</span><br><span class="line">â”œâ”€â”€ routing_table.c</span><br><span class="line">â”œâ”€â”€ routing_table.h</span><br><span class="line">â”œâ”€â”€ seek_list.c</span><br><span class="line">â”œâ”€â”€ seek_list.h</span><br><span class="line">â”œâ”€â”€ tags</span><br><span class="line">â”œâ”€â”€ timer_queue.c</span><br><span class="line">â””â”€â”€ timer_queue.h</span><br><span class="line"></span><br><span class="line">2 directories, 65 files</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é€šè¿‡åœ¨ AODV é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œ <code>tree</code> å¯ä»¥å¾—åˆ°å¦‚ä¸Šé¢ä»£ç å—ä¸­çš„ç»“æœã€‚é¡¹ç›®ä¸­å…±æœ‰65ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­é€šè¿‡åˆ†æ Makefile æ–‡ä»¶ä¸­çš„ç¼–è¯‘é“¾æ¥æ–¹å¼æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒAODV é¡¹ç›®å…±æä¾›äº†ä¸¤å¤§æ–¹å‘ï¼Œåˆ†åˆ«ä¸º ns-2 æ¨¡æ‹Ÿå™¨è¿è¡Œå’Œå®é™…è¿è¡ŒæœåŠ¡ã€‚</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SRC =  main.c list.c debug.c timer_queue.c aodv_socket.c aodv_hello.c \</span><br><span class="line">  aodv_neighbor.c aodv_timeout.c routing_table.c seek_list.c \</span><br><span class="line">  aodv_rreq.c aodv_rrep.c aodv_rerr.c nl.c</span><br><span class="line"></span><br><span class="line">SRC_NS =   debug.c list.c timer_queue.c aodv_socket.c aodv_hello.c \</span><br><span class="line">    aodv_neighbor.c aodv_timeout.c routing_table.c seek_list.c \</span><br><span class="line">    aodv_rreq.c aodv_rrep.c aodv_rerr.c</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼ŒSRC æ˜¯ä¸ºå®é™…è¿è¡Œä½¿ç”¨çš„ c æ–‡ä»¶ï¼Œè€Œ SRC_NS æ˜¯åœ¨ NS æ¨¡æ‹Ÿå™¨ä¸­ç¼–è¯‘éœ€è¦ä½¿ç”¨çš„æ–‡ä»¶ã€‚åœ¨è¿™æ¬¡å¯¹ AODV æºä»£ç åˆ†æçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åªå…³æ³¨äºå®ƒè¿ç”¨åœ¨å®è·µä¸­çš„ä»£ç éƒ¨åˆ†ã€‚æ‰€ä»¥ä¸ä»…æ˜¯ SRC_NS çš„æ–‡ä»¶ï¼Œåœ¨ SRC çš„æ–‡ä»¶ä¸­å¦‚æœé‡åˆ°ä¾‹å¦‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> NS_PORT</span></span><br><span class="line"><span class="comment">/* code */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éƒ½å¯ä»¥å°†å…¶åŒ–ç®€ã€‚</p><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰éœ€è¦æŸ¥çœ‹çš„æºä»£ç æ–‡ä»¶æ ¹æ®æˆ‘ä»¬å®šä¸‹çš„é˜…è¯»é¡ºåºè¿›è¡Œäº†åˆ†ç±»ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><ul><li>Preparation<ul><li>params.h: AODV è¿è¡Œæ—¶çš„å‚æ•°å®šä¹‰</li><li>defs.h: åŒ…å«äº† AODV ä»£ç ä¸­çš„ä¸»è¦å®å®šä¹‰ï¼Œä¾‹å¦‚ <code>MINTTL</code>ã€AODV message type ç­‰å…¨å±€å®å®šä¹‰ï¼Œä»¥åŠå¯¹ä¸»æœºå’Œç½‘å¡è®¾å¤‡çš„ä¿¡æ¯ç»“æ„ä½“ <code>host_info</code> å’Œ<code>dev_info</code></li><li>list.{c|h}: å¯¹å¾ªç¯åŒé“¾è¡¨ç»“æ„ <code>list_t</code> çš„å®šä¹‰åŠæ“ä½œ</li><li>timer_queue.{c|h}: å®šæ—¶å™¨ <code>timer</code> çš„å®šä¹‰åŠæ“ä½œï¼Œä¾æ‰˜äº <code>list_t</code> å¾ªç¯åŒé“¾è¡¨è¿›è¡Œä¸²è”</li><li>routing_table.{c|h}: è·¯ç”±è¡¨çš„å®šä¹‰åŠæ“ä½œ</li><li>endian.c: å¯¹äºç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å¤§å°ç«¯çš„å®šä¹‰ï¼Œè¢«åº”ç”¨äº aodv ç»“æ„ä½“å†…å˜é‡é¡ºåº</li></ul></li><li>AODV Message<ul><li>aodv_hello.{c|h}: </li><li>aodv_neighbor.{c|h}:</li><li>aodv_rreq.{c|h}:</li><li>aodv_rrep.{c|h}:</li><li>aodv_rerr.{c|h}:</li><li>aodv_socket.{c|h}:</li><li>aodv_timeout.{c|h}:</li></ul></li><li>Main<ul><li>llf.{c|h}: é“¾è·¯å±‚åé¦ˆ</li><li>locality.{c|h}: å¯»æ‰¾ç›®çš„åœ°çš„æ–¹ä½</li><li>nl.{c|h}: AODV åè®®ä¸“ç”¨å¥—æ¥å­—</li><li>seek_list.{c|h}: RREQå¯»æ‰¾çš„ç›®çš„åœ°é“¾è¡¨</li><li>main.c: åè®®åˆå§‹åŒ–å’Œè¿è¡Œ</li></ul></li></ul><hr><h2 id="define-do-while-0"><a href="#define-do-while-0" class="headerlink" title="#define do while (0)"></a><code>#define do while (0)</code></h2><p><a target="_blank" rel="noopener" href="https://www.linuxidc.com/Linux/2014-10/108520.htm">Cè¯­è¨€å®å®šè¯­æ‰§è¡Œå¤šæ¡è¯­å¥ä¸€èˆ¬éƒ½ä¼šç”¨ do { â€¦ } while (0)</a></p><hr><h2 id="list-c"><a href="#list-c" class="headerlink" title="list.c"></a><code>list.c</code></h2><ul><li><code>list.c</code> æ–‡ä»¶æ˜¯æ‰€æœ‰<strong>å¾ªç¯åŒé“¾è¡¨</strong> æ“ä½œï¼Œæœ‰ä¸€ä¸ªç©ºçš„å¤´èŠ‚ç‚¹ head<ul><li><code>listelm_detach</code>: æŠŠä¸¤ä¸ªå‚æ•°çš„èŠ‚ç‚¹è¿æ¥èµ·æ¥</li><li><code>listelm_add</code>: ç¬¬ä¸€ä¸ªå‚æ•°çš„èŠ‚ç‚¹æ·»åŠ åˆ°åä¸¤ä¸ªèŠ‚ç‚¹ä¸­é—´</li><li><code>list_add</code>: æ’å…¥å¤´èŠ‚ç‚¹ä¹‹åçš„é‚£ä¸ªä½ç½®</li><li><code>list_add_tail</code>: ç›¸å½“äºæ’å…¥tailä½ç½®</li><li><code>list_detach</code>: æŠŠå‚æ•°ä¸­çš„èŠ‚ç‚¹åˆ é™¤</li></ul></li></ul><blockquote><p>æ‰€æœ‰ <code>list_t *le</code> éƒ½å…¨åæ˜¯ list element</p></blockquote><hr><h2 id="Log-Path"><a href="#Log-Path" class="headerlink" title="Log Path"></a>Log Path</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> AODV_LOG_PATH <span class="meta-string">&quot;/var/log/aodvd.log&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> AODV_RT_LOG_PATH <span class="meta-string">&quot;/var/log/aodvd.rtlog&quot;</span></span></span><br></pre></td></tr></table></figure><hr><h2 id="defs-h"><a href="#defs-h" class="headerlink" title="defs.h"></a><code>defs.h</code></h2><ul><li><p><code>defs.h</code></p><ul><li><p>host ä¸»æœº, dev ç½‘å¡</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Data for a network device */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">dev_info</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> enabled; <span class="comment">/* 1 if struct is used, else 0 */</span></span><br><span class="line">    <span class="keyword">int</span> sock;    <span class="comment">/* AODV socket associated with this device */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_GATEWAY</span></span><br><span class="line">    <span class="keyword">int</span> psock; <span class="comment">/* Socket to send buffered data packets. */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> ifindex;</span><br><span class="line">    <span class="keyword">char</span> ifname[IFNAMSIZ];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">in_addr</span> <span class="title">ipaddr</span>;</span>  <span class="comment">/* The local IP address */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">in_addr</span> <span class="title">netmask</span>;</span> <span class="comment">/* The netmask we use */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">in_addr</span> <span class="title">broadcast</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">host_info</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">u_int32_t</span> seqno;           <span class="comment">/* Sequence number */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">bcast_time</span>;</span> <span class="comment">/* The time of the last broadcast msg sent */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">fwd_time</span>;</span>   <span class="comment">/* The time a data packet was last forwarded */</span></span><br><span class="line">    <span class="keyword">u_int32_t</span> rreq_id;         <span class="comment">/* RREQ id */</span></span><br><span class="line">    <span class="keyword">int</span> nif;                   <span class="comment">/* Number of interfaces to broadcast on */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dev_info</span></span></span><br><span class="line"><span class="class">        <span class="title">devs</span>[<span class="title">MAX_NR_INTERFACES</span> +</span></span><br><span class="line"><span class="class">             1];</span> <span class="comment">/* Add +1 for returning as &quot;error&quot; in ifindex2devindex. */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p><code>host_info</code> ä¸­å­˜å‚¨ <code>def_info</code> æ•°ç»„ï¼Œå¤šå¼€äº†ä¸€ä¸ªä½ç½® <code>(MAX_NR_INTERFACES+1)</code>ï¼Œè®©å‡½æ•°è¿”å›é”™è¯¯æ—¶ä½¿ç”¨ï¼Œæ¥ä»£è¡¨ error</p></li><li><p><code>ifindex</code> å…¨ç§°æ˜¯ network interface index</p></li><li><p>å¯¹ <code>AODV_msg</code> ç»“æ„ä½“è¿›è¡Œç®€åŒ–åä¸º</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">u_int8_t</span> type;</span><br><span class="line">&#125; AODV_msg;</span><br></pre></td></tr></table></figure>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* An generic AODV extensions header */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">u_int8_t</span> type;</span><br><span class="line">    <span class="keyword">u_int8_t</span> length;</span><br><span class="line">    <span class="comment">/* Type specific data follows here */</span></span><br><span class="line">&#125; AODV_ext;</span><br></pre></td></tr></table></figure></li></ul></li></ul><hr><h2 id="å¯¹-list-t-å’Œ-timer-åµŒå¥—ç»“æ„ä½“çš„ç†è§£"><a href="#å¯¹-list-t-å’Œ-timer-åµŒå¥—ç»“æ„ä½“çš„ç†è§£" class="headerlink" title="å¯¹ list_t å’Œ timer åµŒå¥—ç»“æ„ä½“çš„ç†è§£"></a>å¯¹ <code>list_t</code> å’Œ <code>timer</code> åµŒå¥—ç»“æ„ä½“çš„ç†è§£</h2><p><img src="https://s2.loli.net/2021/12/12/ZitwIevknBAWyQ6.jpg" alt="timeré€šè¿‡list_tå®ç°å¾ªç¯åŒé“¾è¡¨"></p><hr><h2 id="timeval-ç»“æ„ä½“åœ¨ä¸åŒç³»ç»Ÿä¸­çš„ä¸åŒå®šä¹‰"><a href="#timeval-ç»“æ„ä½“åœ¨ä¸åŒç³»ç»Ÿä¸­çš„ä¸åŒå®šä¹‰" class="headerlink" title="timeval ç»“æ„ä½“åœ¨ä¸åŒç³»ç»Ÿä¸­çš„ä¸åŒå®šä¹‰"></a><code>timeval</code> ç»“æ„ä½“åœ¨ä¸åŒç³»ç»Ÿä¸­çš„ä¸åŒå®šä¹‰</h2><ul><li><p>åœ¨ Linux ä¸­<code>time.h</code>åº“æ–‡ä»¶å†…</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">timeval</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">__time_t</span> tv_sec;        <span class="comment">/* Seconds. */</span></span><br><span class="line"><span class="keyword">__suseconds_t</span> tv_usec;  <span class="comment">/* Microseconds. */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>åœ¨ macOS ä¸­</p><ul><li><p>util_ldap.h</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> timeval l_timeval</span></span><br></pre></td></tr></table></figure></li><li><p>time.h</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Structure used as a parameter by getitimer(2) and setitimer(2) system</span></span><br><span class="line"><span class="comment"> * calls.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span>  <span class="title">itimerval</span> &#123;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span>  <span class="title">timeval</span> <span class="title">it_interval</span>;</span>    <span class="comment">/* timer interval */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span>  <span class="title">timeval</span> <span class="title">it_value</span>;</span>       <span class="comment">/* current value */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>clock_types.h</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Normal time specification used by the kernel clock facility.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mach_timespec</span> &#123;</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span>    tv_sec;                 <span class="comment">/* seconds */</span></span><br><span class="line">  <span class="keyword">clock_res_t</span>             tv_nsec;                <span class="comment">/* nanoseconds */</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">mach_timespec</span>    <span class="title">mach_timespec_t</span>;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><hr><h2 id="timer-queue-c"><a href="#timer-queue-c" class="headerlink" title="timer_queue.c"></a><code>timer_queue.c</code></h2><ul><li><p><code>timer_queue.c</code></p><ul><li><p><code>timer_timeout</code> å‡½æ•°</p><ul><li>å¯¹ <code>list_t</code> ä¸²è”èµ·æ¥çš„ <code>timer</code> å¾ªç¯åŒé“¾è¡¨ <code>TQ</code></li><li>å¾ªç¯åˆ¤æ–­å…¶æ—¶é—´æ˜¯å¦ä¸ºå½“å‰æ—¶é—´ï¼Œå°† <code>timeout</code> çš„ <code>timer</code> æ”¾å…¥ <code>expTQ</code> ä¸­<ul><li>è‹¥æ˜¯ï¼Œåˆ™ä» <code>TQ</code> ä¸­ç§»é™¤ï¼Œå¹¶åŠ å…¥åˆ° <code>expTQ</code></li><li>è‹¥å¦ï¼Œåˆ™ç»ˆæ­¢å¾ªç¯åˆ¤æ–­</li></ul></li><li>å¾ªç¯æ‰§è¡Œå¹¶åˆ é™¤ <code>expTQ</code> ä¸­ <code>timer</code> çš„ handler function</li></ul></li><li><p><code>timer_remove</code></p><ul><li><code>t-&gt;used</code> ç½® 0</li></ul></li><li><p><code>timer_add</code></p><ul><li><p><code>t-&gt;used</code> ç½® 1</p></li><li><p>åˆ¤æ–­ <code>TQ</code> æ˜¯å¦ä¸ºç©º</p><ul><li>è‹¥ç©ºï¼Œåˆ™ç›´æ¥æ·»åŠ </li><li>è‹¥éç©ºï¼Œåˆ™éå† <code>TQ</code>ï¼Œå°† t æŒ‰ç…§æ—¶é—´é¡ºåºæ·»åŠ åˆ° <code>TQ</code> ä¸­</li></ul></li><li><p><code>timer_timeout_now</code></p><ul><li><p>åˆ¤æ–­ <code>timer</code> æ˜¯å¦åœ¨ <code>TQ</code> ä¸­</p><ul><li>è‹¥æ˜¯ï¼Œåˆ™æ‰§è¡Œ <code>handler</code>ï¼Œå¹¶ <code>t-&gt;used</code> ç½® 0ï¼Œ<code>timer</code> ä¾æ—§åœ¨ <code>TQ</code> ä¸­ç­‰å¾…æ‰§è¡Œ</li><li>è‹¥å¦ï¼Œåˆ™è¿”å›-1</li></ul></li><li><p><code>timer_set_timeout</code></p><ul><li><p><code>t-&gt;used</code> ç½® 0</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">t-&gt;timeout.tv_usec += msec * <span class="number">1000</span>;</span><br><span class="line">t-&gt;timeout.tv_sec += t-&gt;timeout.tv_usec / <span class="number">1000000</span>;</span><br><span class="line">t-&gt;timeout.tv_usec = t-&gt;timeout.tv_usec % <span class="number">1000000</span>;</span><br></pre></td></tr></table></figure></li><li><p><code>timer_add(t)</code></p></li></ul></li></ul></li></ul></li></ul></li></ul><hr><h2 id="AODV-Socket"><a href="#AODV-Socket" class="headerlink" title="AODV Socket"></a>AODV Socket</h2><p>åœ¨å¯¹äº <code>aodv_socket.{c|h}</code> æ–‡ä»¶çš„åˆ†æä¸­ï¼Œæˆ‘ä»¬å‘ç°å®ƒå¤§é‡ä¾èµ–äºç³»ç»Ÿ C è¯­è¨€æºä»£ç ä¸­çš„ <code>struct cmsghdr</code>ï¼Œäºæ˜¯æˆ‘ä»¬æŸ¥çœ‹äº†ç³»ç»Ÿæºä»£ç  C è¯­è¨€æ–‡ä»¶ä¸­çš„ <code>socket.h</code> æ–‡ä»¶ï¼Œå¹¶ä»ä¸­æ‰¾åˆ°äº†å¯¹äº <code>msghdr</code> å’Œ <code>cmsghdr</code> ç»“æ„ä½“çš„å®šä¹‰ã€‚</p><ul><li><p><code>msghdr</code>ï¼šç”¨äºè°ƒç”¨ recvmsg å’Œ sendmsg çš„æ¶ˆæ¯å¤´ã€‚åœ¨ recvmsg ä¸­ä½¿ç”¨å€¼ä¸ç»“æœç›¸å¯¹åº”ï¼Œè€Œåœ¨ sendmsg ä¸­ä»…ä½¿ç”¨å€¼ã€‚</p><ul><li>å¥—æ¥å£åœ°å€æˆå‘˜ <code>msg_name</code> ä¸ <code>msg_namelen</code>ï¼Œåˆ†åˆ«æŒ‡å‘æˆ‘ä»¬è¦å‘é€æˆ–æ˜¯æ¥æ”¶ä¿¡æ¯çš„å¥—æ¥å£åœ°å€åŠè¿™ä¸ªå¥—æ¥å£åœ°å€çš„é•¿åº¦<ul><li>å½“è°ƒç”¨ recvmsg æ—¶ï¼Œmsg_name ä¼šæŒ‡å‘ä¸€ä¸ªå°†è¦æ¥æ”¶çš„åœ°å€çš„æ¥æ”¶åŒºåŸŸ</li><li>å½“è°ƒç”¨ sendmsg æ—¶ï¼Œå®ƒä¼šæŒ‡å‘ä¸€ä¸ªæ•°æ®æŠ¥å°†è¦å‘é€åˆ°çš„ç›®çš„åœ°å€</li></ul></li><li>I/O å‘é‡å¼•ç”¨ <code>msg_iov</code> ä¸ <code>msg_iovlen</code></li><li>é™„å±æ•°æ®ç¼“å†²åŒºæˆå‘˜ <code>msg_control</code> ä¸ <code>msg_controllen</code></li><li>æ¥æ”¶ä¿¡æ¯æ ‡è®°ä½ <code>msg_flags</code>ï¼Œå…¶å¯ä»¥æ¥æ”¶çš„æ ‡è®°å¦‚ä¸‹</li></ul><table><thead><tr><th>æ ‡è®°ä½</th><th>æè¿°</th></tr></thead><tbody><tr><td>MSG_EOR</td><td>å½“æ¥æ”¶åˆ°è®°å½•ç»“å°¾æ—¶ä¼šè®¾ç½®è¿™ä¸€ä½ã€‚è¿™é€šå¸¸å¯¹äºSOCK_SEQPACKETå¥—æ¥å£ç±»å‹ååˆ†æœ‰ç”¨</td></tr><tr><td>MSG_TRUNC</td><td>è¿™ä¸ªæ ‡è®°ä½è¡¨æ˜æ•°æ®çš„ç»“å°¾è¢«æˆªçŸ­ï¼Œå› ä¸ºæ¥æ”¶ç¼“å†²åŒºå¤ªå°ä¸è¶³ä»¥æ¥æ”¶å…¨éƒ¨çš„æ•°æ®</td></tr><tr><td>MSG_CTRUNC</td><td>è¿™ä¸ªæ ‡è®°ä½è¡¨æ˜æŸäº›æ§åˆ¶æ•°æ®(é™„å±æ•°æ®)è¢«æˆªçŸ­ï¼Œå› ä¸ºç¼“å†²åŒºå¤ªå°</td></tr><tr><td>MSG_OOB</td><td>è¿™ä¸ªæ ‡è®°ä½è¡¨æ˜æ¥æ”¶äº†å¸¦å¤–æ•°æ®</td></tr><tr><td>MSG_ERRQUEUE</td><td>è¿™ä¸ªæ ‡è®°ä½è¡¨æ˜æ²¡æœ‰æ¥æ”¶åˆ°æ•°æ®ï¼Œä½†æ˜¯è¿”å›ä¸€ä¸ªæ‰©å±•é”™è¯¯</td></tr></tbody></table></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">msghdr</span> &#123;</span></span><br><span class="line">    <span class="keyword">void</span>            *msg_name;      <span class="comment">/* [XSI] optional address */</span></span><br><span class="line">    <span class="keyword">socklen_t</span>       msg_namelen;    <span class="comment">/* [XSI] size of address */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span>          <span class="title">iovec</span> *<span class="title">msg_iov</span>;</span> <span class="comment">/* [XSI] scatter/gather array */</span></span><br><span class="line">    <span class="keyword">int</span>             msg_iovlen;     <span class="comment">/* [XSI] # elements in msg_iov */</span></span><br><span class="line">    <span class="keyword">void</span>            *msg_control;   <span class="comment">/* [XSI] ancillary data, see below */</span></span><br><span class="line">    <span class="keyword">socklen_t</span>       msg_controllen; <span class="comment">/* [XSI] ancillary data buffer len */</span></span><br><span class="line">    <span class="keyword">int</span>             msg_flags;      <span class="comment">/* [XSI] flags on received message */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><code>cmsghdr</code>ï¼šmsg_control ç¼“å†²åŒºä¸­è¾…åŠ©æ•°æ®å¯¹è±¡çš„å¤´ã€‚ç”¨äºæä¾›æ•°æ®æŠ¥çš„é¢å¤–ä¿¡æ¯çš„é™„åŠ ä¿¡æ¯ã€‚ æ ¼å¼æ˜¯ä¸€ä¸²ä»¥ cmsghdr ç»“æ„ä¸ºé¦–çš„ä¿¡æ¯å…ƒç´ çš„åºåˆ—ã€‚<ul><li><code>cmsg_len</code>:  é™„å±æ•°æ®çš„å­—èŠ‚è®¡æ•°ï¼Œè¿™åŒ…å«ç»“æ„å¤´çš„å°ºå¯¸ã€‚è¿™ä¸ªå€¼æ˜¯ç”± <code>CMSG_LEN()</code> å®è®¡ç®—çš„</li><li><code>cmsg_level</code>:  è¿™ä¸ªå€¼è¡¨æ˜äº†åŸå§‹çš„åè®®çº§åˆ«(ä¾‹å¦‚ï¼Œ<code>SOL_SOCKET</code>)</li><li><code>cmsg_type</code>:  è¿™ä¸ªå€¼è¡¨æ˜äº†æ§åˆ¶ä¿¡æ¯ç±»å‹(ä¾‹å¦‚ï¼Œ<code>SCM_RIGHTS</code>)</li><li><code>cmsg_data</code>:  è¿™ä¸ªæˆå‘˜å¹¶ä¸å®é™…å­˜åœ¨ã€‚ä»–ç”¨æ¥æŒ‡æ˜å®é™…çš„é¢å¤–é™„å±æ•°æ®æ‰€åœ¨çš„ä½ç½®</li></ul></li></ul><p>å¯¹ <code>msg_level</code> çš„æè¿°å¦‚ä¸‹ï¼š</p><table><thead><tr><th>cmsg_level</th><th>æè¿°</th></tr></thead><tbody><tr><td>SCM_RIGHTS</td><td>é™„å±æ•°æ®å¯¹è±¡æ˜¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦</td></tr><tr><td>SCM_CREDENTIALS</td><td>é™„å±æ•°æ®å¯¹è±¡æ˜¯ä¸€ä¸ªåŒ…å«è¯ä¹¦ä¿¡æ¯çš„ç»“æ„</td></tr></tbody></table><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cmsghdr</span> &#123;</span></span><br><span class="line">    <span class="keyword">socklen_t</span>       cmsg_len;       <span class="comment">/* [XSI] data byte count, including hdr */</span></span><br><span class="line">    <span class="keyword">int</span>             cmsg_level;     <span class="comment">/* [XSI] originating protocol */</span></span><br><span class="line">    <span class="keyword">int</span>             cmsg_type;      <span class="comment">/* [XSI] protocol-specific type */</span></span><br><span class="line"><span class="comment">/* followed by    unsigned char  cmsg_data[]; */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>AODV åè®®è®¤ä¸ºç³»ç»Ÿæä¾›çš„æºä»£ç çš„å…³äº routine éƒ¨åˆ†å­˜åœ¨ bugï¼Œæ‰€ä»¥é€šè¿‡ <code>msghdr</code> å’Œ <code>cmsghdr</code> ç»“æ„å¹¶é‡å†™éƒ¨åˆ†å‡½æ•°æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><ul><li><code>__cmsg_nxthdr_fix</code> </li><li><code>cmsg_nxthdr_fix</code></li></ul><p>å…¶ä¸­ <code>cmsg_nxthdr_fix</code> å‡½æ•°è°ƒç”¨ <code>__cmsg_nxthdr_fix</code> æ¥å®Œæˆ</p><ul><li><code>aodv_socket.c</code><ul><li><code>aodv_socket_init</code><ul><li></li></ul></li></ul></li></ul><p>æˆ‘ä»¬åœ¨å¤„ç† AODV åè®®æºä»£ç ä¸­çš„ <code>socket</code> å‡½æ•°æ—¶å‘ç°äº†å¯¹äº <code>PF_INET</code> é‡ï¼Œäºæˆ‘ä»¬åœ¨é«˜çº§ C è¯­è¨€è¯¾ç¨‹ä¸­å­¦ä¹ çš„ <code>AF_INET</code> ä¸åŒã€‚ç»è¿‡åœ¨ç½‘ä¸Šçš„æŸ¥é˜…æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äº Windows ç³»ç»Ÿæ¥è¯´ï¼Œå®ƒåœ¨ <code>Winsock2.h</code> ä¸­å°† <code>PF_INET</code> ä¸ <code>IF_INET</code> ç­‰ä»·</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> AF_INET 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PF_INET AF_INET</span></span><br></pre></td></tr></table></figure><p>è€Œåœ¨ Unix/Linux ç³»ç»Ÿä¸­ï¼Œå¯¹äº BSD æ˜¯ AFï¼Œå¯¹äº POSIX æ˜¯ PFã€‚åœ¨ ã€ŠUnix ç½‘ç»œç¼–ç¨‹ å·1: å¥—æ¥å­—è”ç½‘ APIã€‹ä¹¦ä¸­ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†è¿™ä¸€æ®µè§£é‡Š</p><blockquote><p><code>AF_XXX</code> Versus <code>PF_XXX</code></p><p>The â€œ<code>AF_</code>â€œ prefix stands for â€œaddress familyâ€ and the â€œ<code>PF_</code>â€œ prefix stands for â€œprotocol familyâ€. Historically, the intent was that a single protocol family might support multiple address families and that the <code>PF_</code> value was used to create the socket and the <code>AF_</code> value was used in socket address structures. But in actuality, a protocol family supporting multiple address families has never been supported and the <code>&lt;sys/socket.h&gt;</code> header defines the <code>PF_</code> value for a given protocol to be equal to the <code>AF_</code> value for that protocol. While there is no guarantee that this equality between the two will always be true, should anyone change this for existing protocols, lots of existing code would break. To conform to existing coding practice, we use only the <code>AF_</code> constants in this text, although you may encounter the <code>PF_</code> value, mainly in calls to socket.</p></blockquote><ul><li><p><code>aodv_socket_init</code></p><ul><li><p>åœ¨å‡½æ•°ä¸­ç¬¬ä¸€æ¬¡ä½¿ç”¨äº† ifreq ç»“æ„ä½“ï¼Œè·³è½¬å¾—åˆ°å…¶åŒ–ç®€åçš„éƒ¨åˆ†å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span>  <span class="title">ifreq</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span>    ifr_name[IFNAMSIZ];             <span class="comment">/* if name, e.g. &quot;en0&quot; */</span></span><br><span class="line">    <span class="keyword">union</span> &#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span>  <span class="title">sockaddr</span> <span class="title">ifru_addr</span>;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span>  <span class="title">sockaddr</span> <span class="title">ifru_dstaddr</span>;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span>  <span class="title">sockaddr</span> <span class="title">ifru_broadaddr</span>;</span></span><br><span class="line">        <span class="keyword">short</span>   ifru_flags;</span><br><span class="line">        <span class="keyword">int</span>     ifru_metric;</span><br><span class="line">        <span class="keyword">int</span>     ifru_mtu;</span><br><span class="line">        <span class="keyword">int</span>     ifru_phys;</span><br><span class="line">        <span class="keyword">int</span>     ifru_media;</span><br><span class="line">        <span class="keyword">int</span>     ifru_intval;</span><br><span class="line">        <span class="keyword">caddr_t</span> ifru_data;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span>  <span class="title">ifdevmtu</span> <span class="title">ifru_devmtu</span>;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span>  <span class="title">ifkpi</span>   <span class="title">ifru_kpi</span>;</span></span><br><span class="line">        <span class="keyword">u_int32_t</span> ifru_wake_flags;</span><br><span class="line">        <span class="keyword">u_int32_t</span> ifru_route_refcnt;</span><br><span class="line">        <span class="keyword">int</span>     ifru_cap[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">u_int32_t</span> ifru_functional_type;</span><br><span class="line">    &#125; ifr_ifru;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç»“æ„ä½“ä¸­åŒ…å«äº†ä¸¤éƒ¨åˆ†ï¼ŒåŒ…æ‹¬æ¥å£ interface çš„åç§°å’Œä¸€ä¸ª union ç±»å‹çš„å®šä¹‰ã€‚ifreq ä¸ºæ¥å£è¯·æ±‚ç»“æ„ï¼Œç”¨äºå¥—æ¥å­— ioctl çš„æ¥å£è¯·æ±‚ç»“æ„ã€‚ æ‰€æœ‰çš„æ¥å£ IOctl å¿…é¡»æœ‰å‚æ•°å®šä¹‰ï¼Œè¯¥å®šä¹‰ä»¥ ifr_name å¼€å¤´ã€‚ å…¶ä½™çš„å…¶ä½™çš„å¯ä»¥æ˜¯ç‰¹å®šçš„æ¥å£ã€‚</p></li><li><p>socket åˆå§‹åŒ– udp æ•°æ®åŒ…æ—¶ï¼Œä¼šæŸ¥çœ‹ <code>this_host.nif</code> å³ number of interface to boardcast onã€‚è‹¥ä¸º 0 åˆ™å¼‚å¸¸é€€å‡ºã€‚</p></li><li><p>åœ¨ socket éƒ¨åˆ†æœ‰éå¸¸å¤šçš„å†…å®¹åœ¨é«˜çº§ C è¯­è¨€è¯¾ç¨‹ Unix ç½‘ç»œç¼–ç¨‹ä¸­å­¦åˆ°è¿‡ï¼Œå¦‚ <code>socket(PF_INET, SOCK_DGRAM, IPPROTO_UDP)</code> æ¥åˆ›å»º UDP åŒ…ï¼Œä½†åœ¨ aodv åè®®ä¸­ï¼Œå‡ä½¿ç”¨äº† <code>PF_INET</code> æ¥æ›¿æ¢åŸå§‹çš„ <code>AF_INET</code></p></li><li><p>åœ¨ Unix Network Programming ä¸­ï¼Œä½œè€…æåˆ°ä»–å»ºè®®ä½¿ç”¨ <code>bzero</code> æ¥æ›¿æ¢ <code>memset(&amp;aodv_addr, 0, sizeof(aodv_addr))</code>ï¼Œæˆ‘ä»¬ç»„æˆå‘˜ä¹ŸæŸ¥é˜…äº†è¿™ä¸¤ç§åœ¨å†…å­˜å±‚é¢ä¸Šå¯¹å…¶èµ‹å€¼ä¸º 0 çš„åŒºåˆ«ã€‚<code>bcopy</code>ã€<code>bzero</code> å’Œ <code>bcmp</code> æ˜¯ä¼ ç»Ÿ BSD çš„å‡½æ•°ï¼Œå±äº POSIX æ ‡å‡†ï¼›<code>mem*</code> æ˜¯ C90 (ä»¥åŠ C99)æ ‡å‡†çš„ C å‡½æ•°ã€‚åŒºåˆ«åœ¨äºï¼Œå¦‚æœä½ æ‰“ç®—æŠŠç¨‹åºå¼„åˆ°ä¸€ä¸ªç¬¦åˆ C90/C99ï¼Œä½†æ˜¯ä¸ç¬¦åˆ POSIX æ ‡å‡†çš„å¹³å°æ—¶ï¼Œåè€…ä¼šæ›´æœ‰ä¼˜åŠ¿ã€‚ä½†æ˜¯ <code>memset</code> å‡½æ•°çš„ç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªå‚æ•°éœ€è¦å•ç‹¬è®°å¿†</p><blockquote><p>C has memset(), the Berkeley UNIX C library has <strong>bzero</strong>(). They are not<br>identical, and <strong>bzero</strong>() pre dates memset() but is not widely available (since<br>itâ€™s not part of standard C</p></blockquote></li><li><p>å‡½æ•°ä¸­é€šè¿‡ <code>setsockopt</code> ç»™ socket è®¾ç½®äº†ä»¥ä¸‹çš„å­—æ®µé€‰é¡¹ï¼š</p><ul><li><code>SOL_SOCKET</code> - <code>SO_BROADCAST</code>ï¼šå…è®¸å‘é€å¹¿æ’­æ•°æ®åŒ…</li><li><code>SOL_SOCKET</code> - <code>SO_BINDTODEVICE</code>ï¼šå°†å¥—æ¥å­—ç»‘å®šåˆ°æŒ‡å®šæ¥å£</li><li><code>SOL_SOCKET</code> - <code>SO_PRIORITY</code>ï¼šè®¾ç½®åœ¨å¥—æ¥å­—å‘é€çš„æ‰€æœ‰åŒ…çš„åè®®å®šä¹‰ä¼˜å…ˆæƒ</li><li><code>SOL_SOCKET</code> - <code>SO_RCVBUF</code>ï¼šæ¥å—ç¼“å†²åŒºå¤§å°</li><li><code>SOL_IP</code> - <code>IP_RECVTTL</code>ï¼šä¼ é€ä¸€æ¡å¸¦æœ‰ç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºçš„æ¥æ”¶åŒ…ç”Ÿå­˜æ—¶é—´å­—æ®µçš„ IP_RECVTTL æ§åˆ¶ä¿¡æ¯</li><li><code>SOL_IP</code> - <code>IP_PKTINFO</code>ï¼šè·å–æ¥æ”¶æŠ¥æ–‡çš„ç›¸å…³ä¿¡æ¯ï¼Œä¹Ÿå¯åœ¨å‘é€æŠ¥æ–‡æ—¶æŒ‡å®šæŠ¥æ–‡çš„ç›¸å…³æ§åˆ¶ä¿¡æ¯</li></ul></li><li><p>aodv å°† receive buffer size è®¾å®šä¸ºäº† 1024 å¹¶ä¸”ä¸å…è®¸ä¿®æ”¹ï¼ˆæ²¡æœ‰é€šè¿‡ <code>#define</code> æˆ–å…¶ä»–å½¢å¼æä¾›ä¾¿äºä¿®æ”¹çš„æ–¹æ³•ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (setsockopt(DEV_NR(i).sock, SOL_SOCKET, SO_RCVBUF,</span><br><span class="line">               (<span class="keyword">char</span> *)&amp;bufsize, optlen) == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    alog(LOG_NOTICE, <span class="number">0</span>, __FUNCTION__,</span><br><span class="line">         <span class="string">&quot;Receive buffer size set to %d&quot;</span>, bufsize);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (bufsize &lt; RECV_BUF_SIZE)</span><br><span class="line">&#123;</span><br><span class="line">    alog(LOG_ERR, <span class="number">0</span>, __FUNCTION__,</span><br><span class="line">         <span class="string">&quot;Could not set receive buffer size&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>aodv_socket_process_packet</code></p><ul><li>ç¡®ä¿é‚»å±…èŠ‚ç‚¹å·²ç»è¢«æ·»åŠ æˆ–æ›´æ–°</li><li>åˆ¤æ–­æ¶ˆæ¯æŠ¥æ–‡ç±»å‹<ul><li>é€šè¿‡ <code>type == RREP &amp; ttl == 1 &amp; dst.s_addr == AODV_BROADCAST</code> åˆ¤æ–­æ˜¯å¦ä¸º Hello åŒ…ï¼Œå¹¶è°ƒç”¨ hello_process æ¥å¯¹ Hello åŒ…è¿›è¡Œå¤„ç†</li><li><code>AODV_RREQ</code>: <code>rreq_process((RREQ *)aodv_msg, len, src, dst, ttl, ifindex)</code></li><li><code>AODV_RREP</code>: <code>rrep_process((RREP *)aodv_msg, len, src, dst, ttl, ifindex)</code></li><li><code>AODV_RERR</code>: <code>rerr_process((RERR *)aodv_msg, len, src, dst)</code></li><li><code>AODV_RREP_ACK</code>: <code>rrep_ack_process((RREP_ack *)aodv_msg, len, src, dst)</code></li></ul></li></ul></li><li><p><code>aodv_socket_read</code></p><ul><li>æœ¬å‡½æ•°è´Ÿè´£è¯»å–å¹¶è°ƒç”¨ <code>aodv_socket_process_packet</code> å¤„ç† AODV socket åŒ…ï¼Œåœ¨ NS-2 ç³»ç»Ÿä¸­ï¼Œå‡½æ•°ä¸º <code>recvAODVUUPacket</code></li><li>é€šè¿‡ <code>recvmsg(fd, &amp;msgh, 0)</code>  è¯»å– socketï¼Œå¹¶ä»æ§åˆ¶ä¿¡æ¯ä¸­è·å– ttl å’Œç›®æ ‡åœ°å€ã€‚é€šè¿‡åˆ¤æ–­ <code>cmsg-&gt;cmsg_type</code><ul><li><code>IP_TTL</code>: <code>ttl = *(CMSG_DATA(cmsg));</code></li><li><code>IP_PKTINFO</code>: <code>struct in_pktinfo *pi = (struct in_pktinfo *)CMSG_DATA(cmsg); dst.s_addr = pi-&gt;ipi_addr.s_addr;</code></li></ul></li><li>è‹¥ TTL ä¸ºè´Ÿå€¼ï¼Œåˆ™å¼‚å¸¸ï¼Œå¹¶è¿›è¡Œç©ºè¿”å›</li><li>é€šè¿‡ <code>devfromsock</code> å°è¯•å°† <code>sockf</code> è½¬æ¢ä¸º <code>dev_info</code>ï¼Œå¯¹è½¬æ¢é”™è¯¯å³ç©ºæŒ‡é’ˆçš„è¿”å›åŒæ ·æŒ‰ç…§å¼‚å¸¸å¤„ç†å¹¶è¿›è¡Œç©ºè¿”å›</li></ul></li><li><p><code>aodv_socket_send</code></p><ul><li><p>æœ¬å‡½æ•°è´Ÿè´£å‘é€ AODV socket æ•°æ®åŒ…</p></li><li><p>ä¸å¤„ç† AODV_RREP æ•°æ®åŒ…ï¼Œå¹¶ä¸”å½“ <code>wait_on_reboot</code> è¢«è®¾ç½®ä¸ºçœŸæ—¶ä¹Ÿä¸å†å‘é€æ•°æ®åŒ…</p></li><li><p>è®¾ç½® socket çš„ TTL å€¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setsockopt(dev-&gt;sock, SOL_IP, IP_TTL, &amp;ttl, <span class="keyword">sizeof</span>(ttl))</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœé€Ÿç‡é™åˆ¶è¢«å¯ç”¨ï¼Œæ£€æŸ¥æˆ‘ä»¬æ˜¯å¦æ­£åœ¨å‘é€ä¸€ä¸ª RREQ æˆ– RERRã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸¢å¼ƒä¼ å‡ºçš„æ§åˆ¶æ•°æ®åŒ…ã€‚å¦‚æœè·ç¦»ä¸Šæ¬¡å‘é€è¯¥ç±»å‹çš„æ•°æ®åŒ…çš„æ—¶é—´å°‘äºæˆ–å°äºå…è®¸çš„ RATE LIMIT æ—¶é—´</p></li></ul></li><li><p><code>aodv_socket_new_msg</code></p><ul><li>ä¸ºæ–°äº§ç”Ÿçš„æ•°æ®åŒ…å‘é€ç¼“å†²ç©ºé—´</li></ul></li><li><p><code>aodv_socket_queue_msg</code></p><ul><li>æŠŠä¸€ä¸ªAODVæ¶ˆæ¯å­˜å‚¨åœ¨å‘é€ç¼“å†²åŒºä¸­</li></ul></li><li><p><code>aodv_socket_clean</code></p><ul><li>æ¸…ç©ºå¥—æ¥å­—ä¿¡æ¯å¹¶å…³é—­</li></ul></li></ul><p>å¯¹éƒ¨åˆ† Socket å‡½æ•°çš„è¯¦ç»†è§£é‡Šå°†æ”¾åœ¨å†…å®¹ä¸­</p><hr><h2 id="RREQ"><a href="#RREQ" class="headerlink" title="RREQ"></a><code>RREQ</code></h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>                   <span class="number">1</span>                   <span class="number">2</span>                   <span class="number">3</span></span><br><span class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|     Type      |J|R|G|D|U|      Reserved       |   Hop Count   |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                            RREQ ID                            |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                    Destination IP Address                     |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                  Destination Sequence Number                  |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                    Originator IP Address                      |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                  Originator Sequence Number                   |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></pre></td></tr></table></figure><p>ç–‘é—®ğŸ¤”ï¸ï¼šä»£ç å®é™…æ²¡æœ‰ U æ ‡å¿—</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">u_int8_t</span> type;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(__LITTLE_ENDIAN)</span></span><br><span class="line">    <span class="keyword">u_int8_t</span> res1:<span class="number">4</span>;</span><br><span class="line">    <span class="keyword">u_int8_t</span> d:<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">u_int8_t</span> g:<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">u_int8_t</span> r:<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">u_int8_t</span> j:<span class="number">1</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(__BIG_ENDIAN)</span></span><br><span class="line">    <span class="keyword">u_int8_t</span> j:<span class="number">1</span>;    <span class="comment">/* Join flag (multicast) */</span></span><br><span class="line">    <span class="keyword">u_int8_t</span> r:<span class="number">1</span>;    <span class="comment">/* Repair flag */</span></span><br><span class="line">    <span class="keyword">u_int8_t</span> g:<span class="number">1</span>;    <span class="comment">/* Gratuitous RREP flag */</span></span><br><span class="line">    <span class="keyword">u_int8_t</span> d:<span class="number">1</span>;    <span class="comment">/* Destination only respond */</span></span><br><span class="line">    <span class="keyword">u_int8_t</span> res1:<span class="number">4</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">error</span> <span class="meta-string">&quot;Adjust your &lt;bits/endian.h&gt; defines&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">u_int8_t</span> res2;</span><br><span class="line">    <span class="keyword">u_int8_t</span> hcnt;</span><br><span class="line">    <span class="keyword">u_int32_t</span> rreq_id;</span><br><span class="line">    <span class="keyword">u_int32_t</span> dest_addr;</span><br><span class="line">    <span class="keyword">u_int32_t</span> dest_seqno;</span><br><span class="line">    <span class="keyword">u_int32_t</span> orig_addr;</span><br><span class="line">    <span class="keyword">u_int32_t</span> orig_seqno;</span><br><span class="line">&#125; RREQ;</span><br></pre></td></tr></table></figure><ul><li><p><code>aodv_rreq.c</code></p><ul><li><p><code>rare_create</code></p><ul><li><p>åˆ›å»º <code>RREQ</code> å¹¶åˆå§‹åŒ–</p></li><li><p>seq number increaseï¼ˆ0 ä»ä¸º 0ï¼Œæœ€å¤§å€¼æ—¶å˜ä¸º 1ï¼Œå…¶ä»–æ­£å¸¸ +1ï¼‰</p><ul><li>å½“æŸä¸€èŠ‚ç‚¹è¦äº§ç”Ÿ RREQ æ´ªæ³›ï¼Œå¿…é¡»å…ˆå¢å¤§è‡ªèº«åºåˆ—å·</li></ul></li><li><p><code>flag</code> åŒ¹é…å¹¶ç»™å¯¹åº”çš„å€¼èµ‹ 1</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* RREQ Flags: */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RREQ_JOIN          0x1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RREQ_REPAIR        0x2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RREQ_GRATUITOUS    0x4</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RREQ_DEST_ONLY     0x8</span></span><br></pre></td></tr></table></figure><ul><li><p>ç–‘é—®ğŸ¤”ï¸ï¼šä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨æ•°ç»„è®°å½•ï¼Œæˆ–ç›´æ¥ä½¿ç”¨ <code>flag</code> è®°å½•ï¼Ÿç›®å‰ç”¨äºåŒ¹é…çš„ä»£ç å¦‚ä¸‹</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (flags &amp; RREQ_JOIN)</span><br><span class="line">    rreq-&gt;j = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (flags &amp; RREQ_REPAIR)</span><br><span class="line">    rreq-&gt;r = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (flags &amp; RREQ_GRATUITOUS)</span><br><span class="line">    rreq-&gt;g = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (flags &amp; RREQ_DEST_ONLY)</span><br><span class="line">    rreq-&gt;d = <span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li>è§£é‡Šï¼šå¯ä»¥åŒæ—¶æœ‰å¤šä¸ª <code>flag</code></li></ul></li><li><p><code>rreq_add_ext</code></p><ul><li><p>ç”¨äºå¯¹ RREQ è¿›è¡Œè¡¥å……</p></li><li><p>å­˜æ”¾äº <code>(AODV_ext *)((char *)rreq + offset)</code></p><ul><li><code>offset</code> åº”å¤§äºæˆ–ç­‰äº <code>RREQ_SIZE</code></li></ul></li><li><p><code>AODV_ext</code> å­˜å‚¨ä¿¡æ¯</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* An generic AODV extensions header */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">u_int8_t</span> type;</span><br><span class="line">    <span class="keyword">u_int8_t</span> length;</span><br><span class="line">    <span class="comment">/* Type specific data follows here */</span></span><br><span class="line">&#125; AODV_ext;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><code>type</code></li><li><code>length</code></li></ul></li><li><p>å°† data å¤åˆ¶åˆ° <code>((char *)((char *)ext + sizeof(AODV_ext))</code></p></li></ul></li><li><p><code>rreq_send</code></p><ul><li><p><code>struct in_addr</code></p></li><li><p><code>apr_uint32_t</code></p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">in_addr</span> &#123;</span></span><br><span class="line">    <span class="keyword">apr_uint32_t</span>  s_addr; <span class="comment">/**&lt; storage to hold the IP# */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><code>unsigned int</code><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dest.s_addr = AODV_BROADCAST;</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Broadcast on all interfaces */</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; MAX_NR_INTERFACES; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!DEV_NR(i).enabled)</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    rreq = rreq_create(flags, dest_addr, dest_seqno, DEV_NR(i).ipaddr);</span><br><span class="line">    aodv_socket_send((AODV_msg *)rreq, dest, RREQ_SIZE, ttl, &amp;DEV_NR(i));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å¹¿æ’­ <code>dest.s_addr = AODV_BROADCAST;</code></p></li><li><p>åˆ›å»º RREQ å¹¶å‘é€æŠ¥æ–‡</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rreq = rreq_create(flags, dest_addr, dest_seqno, DEV_NR(i).ipaddr);</span><br><span class="line">aodv_socket_send((AODV_msg *)rreq, dest, RREQ_SIZE, ttl, &amp;DEV_NR(i));</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p><code>rreq_forward</code></p><ul><li><p>è®°å½•ç›®çš„å’Œæº</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dest.s_addr = AODV_BROADCAST;</span><br><span class="line">orig.s_addr = rreq-&gt;orig_addr;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>è‹¥ TTL ä»ç„¶å¤§äº 0 æ—¶ç»§ç»­è½¬å‘</p></li><li><p>æŠ¥æ–‡è¿›å…¥é˜Ÿåˆ— <code>send_buf</code>ï¼Œç­‰å¾…å‘é€</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rreq = (RREQ *)aodv_socket_queue_msg((AODV_msg *)rreq, size);</span><br></pre></td></tr></table></figure></li><li><p>å¢åŠ è·³æ•° hcnt <code>rreq-&gt;hcnt++;</code></p></li><li><p>è½¬å‘å‘é€ç¼“å†²åŒº <code>send_buf</code> ä¸­çš„æŠ¥æ–‡</p></li><li><p>ç–‘é—®ğŸ¤”ï¸ï¼šè½¬å‘æ—¶ TTL-1 æ“ä½œæ²¡æœ‰æ‰¾åˆ°</p><ul><li><p>å›ç­”ï¼šforward ä¸­åªè½¬å‘ï¼Œåœ¨ process ä¸­æ‰¾åˆ°å¦‚ä¸‹çš„å¯¹ TTL çš„å¤„ç†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (ip_ttl &gt; <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* Update the sequence number in case the maintained one is</span></span><br><span class="line"><span class="comment">     * larger */</span></span><br><span class="line">    <span class="keyword">if</span> (fwd_rt &amp;&amp; !(fwd_rt-&gt;flags &amp; RT_INET_DEST) &amp;&amp;</span><br><span class="line">        (<span class="keyword">int32_t</span>)fwd_rt-&gt;dest_seqno &gt; (<span class="keyword">int32_t</span>)rreq_dest_seqno)</span><br><span class="line">        rreq-&gt;dest_seqno = htonl(fwd_rt-&gt;dest_seqno);</span><br><span class="line">                                                                </span><br><span class="line">    rreq_forward(rreq, rreqlen, --ip_ttl);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    DEBUG(LOG_DEBUG, <span class="number">0</span>, <span class="string">&quot;RREQ not forwarded - ttl=0&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>å½“ TTL å¤§äº 1 æ—¶ï¼Œåˆ¤æ–­å¹¶è½¬å‘ <code>â€”-ip_ttl</code> çš„åŒ…</p></li></ul></li><li><p><code>rreq_process</code></p><ul><li><p>ç›®çš„å’Œæºçš„åˆå§‹åŒ–</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rreq_dest.s_addr = rreq-&gt;dest_addr;</span><br><span class="line">rreq_orig.s_addr = rreq-&gt;orig_addr;</span><br><span class="line">rreq_id = ntohl(rreq-&gt;rreq_id);</span><br><span class="line">rreq_dest_seqno = ntohl(rreq-&gt;dest_seqno);</span><br><span class="line">rreq_orig_seqno = ntohl(rreq-&gt;orig_seqno);</span><br><span class="line">rreq_new_hcnt = rreq-&gt;hcnt + <span class="number">1</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>å¿½ç•¥ç”±æœ¬èŠ‚ç‚¹å¼€å§‹å‘é€çš„åŒ…</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (rreq_orig.s_addr == DEV_IFINDEX(ifindex).ipaddr.s_addr)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>æ£€æŸ¥æ¥æ”¶åˆ°çš„ RREQ åŒ…çš„ä¸Šä¸€è·³æ˜¯å¦åœ¨é»‘åå•ä¸­ï¼Œè‹¥åœ¨åˆ™å¿½ç•¥è¯¥åŒ…</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (rreq_blacklist_find(ip_src))</span><br><span class="line">&#123;</span><br><span class="line">    DEBUG(LOG_DEBUG, <span class="number">0</span>, <span class="string">&quot;prev hop of RREQ blacklisted, ignoring!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>å¿½ç•¥å·²ç»å¤„ç†è¿‡çš„ RREQ åŒ…ï¼Œé˜²æ­¢å‘ç”Ÿç½‘ç»œé£æš´</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (rreq_record_find(rreq_orig, rreq_id))</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>ç–‘é—®ğŸ¤”ï¸ï¼šæ˜¯å¦å¯ä»¥é€šè¿‡å°†æ£€æŸ¥æ“ä½œå‰ç½®åˆ°å‡½æ•°å†…åˆå§‹åŒ–ä¹‹å‰ï¼Œå°å¹…åº¦æå‡è¿ç®—é€Ÿåº¦</p></li><li><p>ç¼“å­˜æ¥æ”¶åˆ°çš„ RREQ åŒ…ï¼Œä¸‹æ¬¡æ¥æ”¶åˆ°ç›¸åŒåŒ…æ—¶å¯ä»¥å¿½ç•¥ä¸è¿›è¡Œå¤„ç†</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rreq_record_insert(rreq_orig, rreq_id);</span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡ rreqlen å’Œ extlen å¤„ç†åˆ†å‰² RREQ åŒ…</p></li><li><p>è·¯ç”±å‘ç° <code>rt_table_find</code></p><ul><li><p>è‹¥è·¯ç”±è¡¨ä¸­æ²¡æœ‰å­˜å‚¨è¿‡ç›®çš„èŠ‚ç‚¹ï¼Œåˆ™æ·»åŠ åˆ°è·¯ç”±è¡¨ä¸­ <code>rt_table_insert</code></p></li><li><p>è‹¥å‘ç°å·²ç»å­˜å‚¨è¿‡çš„è®°å½•ï¼Œåˆ™å°è¯•è®¡ç®—å‡ºå¼€é”€æœ€å°çš„è·¯å¾„å¹¶æ›´æ–°</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">life = PATH_DISCOVERY_TIME - <span class="number">2</span> * rreq_new_hcnt * NODE_TRAVERSAL_TIME;</span><br><span class="line"></span><br></pre></td></tr></table></figure>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (rev_rt-&gt;dest_seqno == <span class="number">0</span> ||</span><br><span class="line">    (<span class="keyword">int32_t</span>)rreq_orig_seqno &gt; (<span class="keyword">int32_t</span>)rev_rt-&gt;dest_seqno ||</span><br><span class="line">    (rreq_orig_seqno == rev_rt-&gt;dest_seqno &amp;&amp;</span><br><span class="line">     (rev_rt-&gt;state == INVALID || rreq_new_hcnt &lt; rev_rt-&gt;hcnt)))</span><br><span class="line">&#123;</span><br><span class="line">    rev_rt =</span><br><span class="line">        rt_table_update(rev_rt, ip_src, rreq_new_hcnt, rreq_orig_seqno,</span><br><span class="line">                        life, VALID, rev_rt-&gt;flags);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>åˆ¤æ–­è‡ªå·±æ˜¯å¦ä¸ºç›®çš„èŠ‚ç‚¹</p><ul><li><p>è‹¥æ˜¯ç›®çš„èŠ‚ç‚¹ï¼Œç»ˆæ­¢ RREQï¼Œå¼€å§‹ RREQ è¿‡ç¨‹ï¼Œæ›´æ–°æœ€å¤§åºåˆ—å·</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (rreq_dest.s_addr == DEV_IFINDEX(ifindex).ipaddr.s_addr)</span><br><span class="line">&#123;</span><br><span class="line">                                                                           </span><br><span class="line">    <span class="comment">/* WE are the RREQ DESTINATION. Update the node&#x27;s own</span></span><br><span class="line"><span class="comment">       sequence number to the maximum of the current seqno and the</span></span><br><span class="line"><span class="comment">       one in the RREQ. */</span></span><br><span class="line">    <span class="keyword">if</span> (rreq_dest_seqno != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ((<span class="keyword">int32_t</span>)this_host.seqno &lt; (<span class="keyword">int32_t</span>)rreq_dest_seqno)</span><br><span class="line">            this_host.seqno = rreq_dest_seqno;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (this_host.seqno == rreq_dest_seqno)</span><br><span class="line">            seqno_incr(this_host.seqno);</span><br><span class="line">    &#125;</span><br><span class="line">    rrep =</span><br><span class="line">        rrep_create(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, DEV_IFINDEX(rev_rt-&gt;ifindex).ipaddr,</span><br><span class="line">                    this_host.seqno, rev_rt-&gt;dest_addr, MY_ROUTE_TIMEOUT);</span><br><span class="line">                                                                           </span><br><span class="line">    rrep_send(rrep, rev_rt, <span class="literal">NULL</span>, RREP_SIZE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>è‹¥ä¸æ˜¯ç›®çš„èŠ‚ç‚¹ï¼Œåˆ™æŸ¥çœ‹æ˜¯å¦åŒ…å«ç›®çš„èŠ‚ç‚¹çš„è·¯ç”±ä¿¡æ¯</p><ul><li>è‹¥æœ‰åˆ™å›å¤ RREP</li><li>è‹¥æ²¡æœ‰åˆ™ç»§ç»­å¹¿æ’­ RREQ<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* We are an INTERMEDIATE node. - check if we have an active</span></span><br><span class="line"><span class="comment">     * route entry */</span></span><br><span class="line">                                                                          </span><br><span class="line">    fwd_rt = rt_table_find(rreq_dest);</span><br><span class="line">                                                                          </span><br><span class="line">    <span class="keyword">if</span> (fwd_rt &amp;&amp; fwd_rt-&gt;state == VALID &amp;&amp; !rreq-&gt;d)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">now</span>;</span></span><br><span class="line">        <span class="keyword">u_int32_t</span> lifetime;</span><br><span class="line">                                                                          </span><br><span class="line">        <span class="comment">/* GENERATE RREP, i.e we have an ACTIVE route entry that is fresh</span></span><br><span class="line"><span class="comment">           enough (our destination sequence number for that route is</span></span><br><span class="line"><span class="comment">           larger than the one in the RREQ). */</span></span><br><span class="line">                                                                          </span><br><span class="line">        gettimeofday(&amp;now, <span class="literal">NULL</span>);</span><br><span class="line">                                                                          </span><br><span class="line">        <span class="comment">/* Respond only if the sequence number is fresh enough... */</span></span><br><span class="line">        <span class="keyword">if</span> (fwd_rt-&gt;dest_seqno != <span class="number">0</span> &amp;&amp;</span><br><span class="line">            (<span class="keyword">int32_t</span>)fwd_rt-&gt;dest_seqno &gt;= (<span class="keyword">int32_t</span>)rreq_dest_seqno)</span><br><span class="line">        &#123;</span><br><span class="line">            lifetime = timeval_diff(&amp;fwd_rt-&gt;rt_timer.timeout, &amp;now);</span><br><span class="line">            rrep = rrep_create(<span class="number">0</span>, <span class="number">0</span>, fwd_rt-&gt;hcnt, fwd_rt-&gt;dest_addr,</span><br><span class="line">                               fwd_rt-&gt;dest_seqno, rev_rt-&gt;dest_addr,</span><br><span class="line">                               lifetime);</span><br><span class="line">            rrep_send(rrep, rev_rt, fwd_rt, rrep_size);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">goto</span> forward;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* If the GRATUITOUS flag is set, we must also unicast a</span></span><br><span class="line"><span class="comment">           gratuitous RREP to the destination. */</span></span><br><span class="line">        <span class="keyword">if</span> (rreq-&gt;g)</span><br><span class="line">        &#123;</span><br><span class="line">            rrep = rrep_create(<span class="number">0</span>, <span class="number">0</span>, rev_rt-&gt;hcnt, rev_rt-&gt;dest_addr,</span><br><span class="line">                               rev_rt-&gt;dest_seqno, fwd_rt-&gt;dest_addr,</span><br><span class="line">                               lifetime);</span><br><span class="line">                                                                          </span><br><span class="line">            rrep_send(rrep, fwd_rt, rev_rt, RREP_SIZE);</span><br><span class="line">                                                                          </span><br><span class="line">            DEBUG(LOG_INFO, <span class="number">0</span>, <span class="string">&quot;Sending G-RREP to %s with rte to %s&quot;</span>,</span><br><span class="line">                  ip_to_str(rreq_dest), ip_to_str(rreq_orig));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">forward:</span><br><span class="line">    <span class="keyword">if</span> (ip_ttl &gt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/* Update the sequence number in case the maintained one is</span></span><br><span class="line"><span class="comment">         * larger */</span></span><br><span class="line">        <span class="keyword">if</span> (fwd_rt &amp;&amp; !(fwd_rt-&gt;flags &amp; RT_INET_DEST) &amp;&amp;</span><br><span class="line">            (<span class="keyword">int32_t</span>)fwd_rt-&gt;dest_seqno &gt; (<span class="keyword">int32_t</span>)rreq_dest_seqno)</span><br><span class="line">            rreq-&gt;dest_seqno = htonl(fwd_rt-&gt;dest_seqno);</span><br><span class="line">                                                                          </span><br><span class="line">        rreq_forward(rreq, rreqlen, --ip_ttl);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        DEBUG(LOG_DEBUG, <span class="number">0</span>, <span class="string">&quot;RREQ not forwarded - ttl=0&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul><hr><h2 id="RREP"><a href="#RREP" class="headerlink" title="RREP"></a><code>RREP</code></h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>                   <span class="number">1</span>                   <span class="number">2</span>                   <span class="number">3</span></span><br><span class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|     Type      |R|A|    Reserved     |Prefix Sz|   Hop Count   |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                     Destination IP address                    |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                  Destination Sequence Number                  |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                    Originator IP address                      |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                           Lifetime                            |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></pre></td></tr></table></figure><ul><li><p><code>rrep_create</code></p><ul><li><p>é€šè¿‡ <code>aodv_socket_new_msg</code> åˆ›å»º socket messageï¼Œå¹¶è¿›è¡Œåˆå§‹åŒ–</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rrep-&gt;type = AODV_RREP;</span><br><span class="line">rrep-&gt;res1 = <span class="number">0</span>;</span><br><span class="line">rrep-&gt;res2 = <span class="number">0</span>;</span><br><span class="line">rrep-&gt;prefix = prefix;</span><br><span class="line">rrep-&gt;hcnt = hcnt;</span><br><span class="line">rrep-&gt;dest_addr = dest_addr.s_addr;</span><br><span class="line">rrep-&gt;dest_seqno = htonl(dest_seqno);</span><br><span class="line">rrep-&gt;orig_addr = orig_addr.s_addr;</span><br><span class="line">rrep-&gt;lifetime = htonl(life);</span><br></pre></td></tr></table></figure></li><li><p>å¯¹ flag è¿›è¡Œä½åˆ¤æ–­ï¼Œå¹¶å°†å¯¹åº”åœ¨ message ä¸­çš„ä½ç½® 1</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (flags &amp; RREP_REPAIR)</span><br><span class="line">    rrep-&gt;r = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (flags &amp; RREP_ACK)</span><br><span class="line">    rrep-&gt;a = <span class="number">1</span>;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>rrep_ack_create</code></p><ul><li><p>åˆ›å»º socket messageï¼Œåˆå§‹åŒ–ä»…éœ€è¦å°†å…¶ç±»å‹è®¾ç½®ä¸º ACK åŒ…</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rrep_ack-&gt;type = AODV_RREP_ACK;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>rrep_ack_process</code></p><ul><li><p>å¤„ç† ACK åŒ…æ—¶ï¼Œå…ˆåœ¨è·¯ç”±è¡¨ä¸­æŸ¥æ‰¾å…¶æº ipï¼Œç„¶ååˆ é™¤è¿™ä¸ª RREP_ACK åŒ…è¿˜æœªåˆ°æœŸçš„è®¡æ—¶å™¨</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timer_remove(&amp;rt-&gt;ack_timer);</span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>rrep_add_ext</code></p><ul><li>é€š RREQ æ—¶çš„å¤„ç†ï¼Œåœ¨ <code>(AODV_ext *)((char *)rrep + offset)</code> ä½ç½®æ·»åŠ  extension ä¿¡æ¯ã€‚å­˜å‚¨ç±»å‹å’Œé•¿åº¦ä¿¡æ¯</li></ul></li><li><p><code>rrep_send</code></p><ul><li><p>æ£€æŸ¥æˆ‘ä»¬æ˜¯å¦åº”è¯¥è¯·æ±‚ <code>RREP_ACK</code>ã€‚å¦‚æœæ”¶åˆ° RREQ çš„èŠ‚ç‚¹æ˜¯é‚»å±…ï¼Œåˆ™å¯èƒ½é¢ä¸´å•å‘é“¾è·¯ï¼Œæœ€å¥½è¯·æ±‚ä¸€ä¸ª<code>RREP_ACK</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (neighbor &amp;&amp; neighbor-&gt;state == VALID &amp;&amp; !neighbor-&gt;ack_timer.used)</span><br><span class="line">&#123;</span><br><span class="line">    rrep_flags |= RREP_ACK;</span><br><span class="line">    neighbor-&gt;flags |= RT_UNIDIR;</span><br><span class="line">                                                                       </span><br><span class="line">    <span class="comment">/* Must remove any pending hello timeouts when we set the</span></span><br><span class="line"><span class="comment">       RT_UNIDIR flag, else the route may expire after we begin to</span></span><br><span class="line"><span class="comment">       ignore hellos... */</span></span><br><span class="line">    timer_remove(&amp;neighbor-&gt;hello_timer);</span><br><span class="line">    neighbor_link_break(neighbor);</span><br><span class="line">                                                                       </span><br><span class="line">    DEBUG(LOG_DEBUG, <span class="number">0</span>, <span class="string">&quot;Link to %s is unidirectional!&quot;</span>,</span><br><span class="line">          ip_to_str(neighbor-&gt;dest_addr));</span><br><span class="line">                                                                       </span><br><span class="line">    timer_set_timeout(&amp;neighbor-&gt;ack_timer, NEXT_HOP_WAIT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½® <code>RT_UNIDIR</code> æ ‡å¿—æ—¶ï¼Œå¿…é¡»åˆ é™¤æ‰€æœ‰å¾…å¤„ç†çš„ Hello è¶…æ—¶ï¼Œå¦åˆ™è·¯ç”±å¯èƒ½ä¼šåœ¨å¼€å§‹å¿½ç•¥ Hello ä¹‹åç»ˆæ­¢</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (fwd_rt)</span><br><span class="line">&#123;</span><br><span class="line">    precursor_add(fwd_rt, rev_rt-&gt;next_hop);</span><br><span class="line">    precursor_add(rev_rt, fwd_rt-&gt;next_hop);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>rrep_forward</code></p><ul><li><p>æ£€æŸ¥æ˜¯å¦åº”è¯¥è¯·æ±‚ <code>RREP_ACK</code>ï¼Œå¦‚æœRREPçš„æ¥æºä¸æ˜¯ä¸€ä¸ªé‚»å±…ï¼Œæˆ‘ä»¬å¿…é¡»æ‰¾åˆ°é‚»å±…æ¡ç›®ï¼Œå®ƒæ˜¯é€šå¾€ RREP æºçš„ä¸‹ä¸€è·³ã€‚å¦‚æœæˆ‘ä»¬æ¥æ”¶åˆ° RREQ çš„èŠ‚ç‚¹æ˜¯é‚»å±…ï¼Œåˆ™æˆ‘ä»¬å¯èƒ½æ­£é¢ä¸´å•å‘é“¾è·¯ï¼Œæœ€å¥½è¯·æ±‚ä¸€ä¸ª <code>RREP_ACK</code></p></li><li><p>ç–‘é—®ğŸ¤”ï¸ï¼šAODV æºç çš„ä½œè€…åœ¨è¿™é‡Œä¹Ÿæ²¡æœ‰å¼„æ˜ç™½ï¼Œä»–ä»¬è®¤ä¸ºè¿™é‡Œå­˜åœ¨ä¸€ä¸ªå•å‘çš„è¿æ¥ï¼Œäºæ˜¯ä½œè€…æš‚ä¸”ä½¿ç”¨äº† <code>if(0)</code> è®©è¿™æ®µä»£ç ä»…ä»…å­˜åœ¨äºç¨‹åºä¸­ä½†æ˜¯ä¸ä¼šè¢«æ‰§è¡Œ</p><blockquote><p>we suspect a unidirectional link</p></blockquote></li></ul></li><li><p><code>rrep_process</code></p><ul><li><p>åœ¨ RREP çš„å¤„ç†ä¸­ï¼Œå°† RREP åŒ…ä¸­çš„åœ°å€ä¿¡æ¯æå–å‡ºæ¥æ”¾å…¥å››å…ƒç»„ä¸­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rrep_dest.s_addr = rrep-&gt;dest_addr;</span><br><span class="line">rrep_orig.s_addr = rrep-&gt;orig_addr;</span><br><span class="line">rrep_seqno = ntohl(rrep-&gt;dest_seqno);</span><br><span class="line">rrep_lifetime = ntohl(rrep-&gt;lifetime);</span><br></pre></td></tr></table></figure></li><li><p>è€ƒè™‘åˆ°ä¸­é—´èŠ‚ç‚¹çš„æƒ…å†µï¼Œå¢åŠ RREPè·³æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rrep_new_hcnt = rrep-&gt;hcnt + <span class="number">1</span>;</span><br></pre></td></tr></table></figure></li><li><p>åœ¨ RREQ çš„å¤„ç†æ—¶ï¼Œä¼šå¿½ç•¥é‚£äº›æ—¨åœ¨å»ºç«‹ä¸€æ¡é€šå¾€è‡ªæˆ‘çš„è·¯çº¿çš„ä¿¡æ¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (rrep_dest.s_addr == DEV_IFINDEX(ifindex).ipaddr.s_addr)</span><br><span class="line">    <span class="keyword">return</span>;</span><br></pre></td></tr></table></figure></li><li><p>å¯¹ RREQ åŒ…æ˜¯å¦è¿˜æœ‰ extension è¿›è¡Œåˆ¤æ–­ï¼Œå¹¶å°†å…¶æ”¾å…¥ ext å˜é‡ä¸­</p></li><li><p>æ£€æŸ¥æ˜¯å¦åº”è¯¥è¿›è¡Œå‰è¿›çš„è·¯çº¿ã€‚è‹¥æ²¡æœ‰ç°æœ‰æ¡ç›®ï¼Œåˆ™æ’å…¥ä¸€ä¸ªæ–°æ¡ç›®ã€‚è‹¥æœ‰ï¼Œåˆ™æ›´æ–°æ¡ç›®</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">fwd_rt = rt_table_find(rrep_dest);</span><br><span class="line">rev_rt = rt_table_find(rrep_orig);</span><br><span class="line">                                                                           </span><br><span class="line"><span class="keyword">if</span> (!fwd_rt)</span><br><span class="line">&#123;</span><br><span class="line">    fwd_rt = rt_table_insert(rrep_dest, ip_src, rrep_new_hcnt, rrep_seqno,</span><br><span class="line">                             rrep_lifetime, VALID, rt_flags, ifindex);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (fwd_rt-&gt;dest_seqno == <span class="number">0</span> ||</span><br><span class="line">         (<span class="keyword">int32_t</span>)rrep_seqno &gt; (<span class="keyword">int32_t</span>)fwd_rt-&gt;dest_seqno ||</span><br><span class="line">         (rrep_seqno == fwd_rt-&gt;dest_seqno &amp;&amp;</span><br><span class="line">          (fwd_rt-&gt;state == INVALID || fwd_rt-&gt;flags &amp; RT_UNIDIR ||</span><br><span class="line">           rrep_new_hcnt &lt; fwd_rt-&gt;hcnt)))</span><br><span class="line">&#123;</span><br><span class="line">    pre_repair_hcnt = fwd_rt-&gt;hcnt;</span><br><span class="line">    pre_repair_flags = fwd_rt-&gt;flags;</span><br><span class="line">                                                                           </span><br><span class="line">    fwd_rt =</span><br><span class="line">        rt_table_update(fwd_rt, ip_src, rrep_new_hcnt, rrep_seqno,</span><br><span class="line">                        rrep_lifetime, VALID, rt_flags | fwd_rt-&gt;flags);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (fwd_rt-&gt;hcnt &gt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        DEBUG(LOG_DEBUG, <span class="number">0</span>,</span><br><span class="line">              <span class="string">&quot;Dropping RREP, fwd_rt-&gt;hcnt=%d fwd_rt-&gt;seqno=%ld&quot;</span>,</span><br><span class="line">              fwd_rt-&gt;hcnt, fwd_rt-&gt;dest_seqno);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœè®¾ç½®äº† <code>RREP_ACK</code> æ ‡å¿—ï¼Œå°† RREP ç¡®è®¤å‘é€åˆ°æ‰€ç­”å¤çš„ç›®çš„åœ°ï¼Œå¹¶ç§»é™¤ <code>RREP_ACK</code> æ ‡å¿—</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (rrep-&gt;a)</span><br><span class="line">&#123;</span><br><span class="line">    RREP_ack *rrep_ack;</span><br><span class="line">                                                                            </span><br><span class="line">    rrep_ack = rrep_ack_create();</span><br><span class="line">    aodv_socket_send((AODV_msg *)rrep_ack, fwd_rt-&gt;next_hop, NEXT_HOP_WAIT,</span><br><span class="line">                     MAXTTL, &amp;DEV_IFINDEX(fwd_rt-&gt;ifindex));</span><br><span class="line">    <span class="comment">/* Remove RREP_ACK flag... */</span></span><br><span class="line">    rrep-&gt;a = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœè·¯ç”±ä»¥å‰å¤„äºä¿®å¤çŠ¶æ€ï¼Œåº”è¯¥å‘è·¯ç”±æºå‘é€ <code>NO DELETE RERR</code>ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥é€‰æ‹©ä¸ºç›®çš„åœ°é‡æ–°å¯åŠ¨è·¯ç”±å‘ç°ã€‚é€šè¿‡è¿™æ ·çš„æ–¹å¼å¯ä»¥ä¿®æ­£ä¸€ä¸ªå¯¼è‡´ä¿®å¤æ ‡å¿—æœªè¢«è®¾ç½®å’Œ <code>RERR</code> ä»æœªè¢«å‘é€çš„é”™è¯¯ã€‚</p></li></ul></li></ul><hr><h2 id="RERR"><a href="#RERR" class="headerlink" title="RERR"></a><code>RERR</code></h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>                   <span class="number">1</span>                   <span class="number">2</span>                   <span class="number">3</span></span><br><span class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|     Type      |N|          Reserved           |   DestCount   |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|            Unreachable Destination IP Address (1)             |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|         Unreachable Destination Sequence Number (1)           |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-|</span><br><span class="line">|  Additional Unreachable Destination IP Addresses (if needed)  |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|Additional Unreachable Destination Sequence Numbers (if needed)|</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></pre></td></tr></table></figure><ul><li><code>rerr_create</code><ul><li>RERR çš„åˆ›å»ºå’Œåˆå§‹åŒ–ä¸ RREQ å’Œ RREP ç±»ä¼¼ï¼Œæ•…è¿™é‡Œä¸å†èµ˜è¿°</li></ul></li><li><code>rerr_add_udest</code><ul><li>æ·»åŠ  RERR ä¿¡æ¯ï¼Œä¸ RREQ å’Œ RREP ä¸­çš„ ext ç±»ä¼¼ï¼Œå‡ä¸ºåœ¨å†…å­˜ä¸­ç»“æ„ä½“åé¢æ·»åŠ é™„åŠ ä¿¡æ¯</li></ul></li><li><code>rerr_process</code><ul><li>åœ¨å¤„ç† RERR æ¶ˆæ¯æ—¶ï¼Œä¼šæ£€æŸ¥å“ªäº›ç›®çš„èŠ‚ç‚¹æ—¶ä¸å¯è¾¾çš„ã€‚æ ¹æ®ä½œè€…çš„æè¿°ï¼Œè¿™äº›å†…å®¹ä»ç„¶åªæ˜¯è‰æ¡ˆ</li><li>ä½¿ç”¨æ•°æ®åŒ…ä¸­çš„ç›®æ ‡åºåˆ—å·æ›´æ–°ç›¸åº”çš„ç›®æ ‡åºåˆ—å·ã€‚æ£€æŸ¥å‰é©±åˆ—è¡¨æ˜¯å¦ä¸ºç©ºã€‚å¦‚æœä¸ä¸ºç©ºï¼Œåˆ™å°†è¯¥ç›®æ ‡ä½œä¸º RERR ä¸­çš„ä¸å¯è®¿é—®ç›®æ ‡ã€‚ç¡®å®šæ˜¯å¦æœ‰æ–°çš„å‰é©±ä½¿å®ƒæˆä¸ºéå•æ’­ RERR å¹¶åˆ é™¤æ‰€æœ‰æ— æ³•åˆ°è¾¾çš„ç›®çš„åœ°çš„å…ˆé©±åˆ—è¡¨</li><li>å¦‚æœåˆ›å»ºäº† RERR æ¶ˆæ¯ï¼Œåˆ™ç«‹å³å‘é€ï¼ŒåŒæ ·éœ€è¦ç»è¿‡è·¯ç”±å‘ç°ç­‰è¿‡ç¨‹ã€‚ä»…åœ¨å…·æœ‰ä¸­æ–­è·¯ç”±çš„å…ˆé©±èŠ‚ç‚¹çš„é‚£äº›æ¥å£ä¸Šå‘é€ RERR</li></ul></li></ul><hr><h2 id="HELLO"><a href="#HELLO" class="headerlink" title="HELLO"></a><code>HELLO</code></h2><ul><li><p><code>hello_start</code></p><ul><li><p>è‹¥è®¡æ—¶å™¨ used åˆ™æ¶ˆæ¯å·²ç»å‘é€</p></li><li><p>è®¾å®šè®¡æ—¶å™¨ï¼Œä¸ Hello è¿›è¡Œç»‘å®š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">timer_init(&amp;hello_timer, &amp;NS_CLASS hello_send, <span class="literal">NULL</span>);</span><br><span class="line">hello_send(<span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>hello_stop</code></p><ul><li><p>ç§»é™¤è®¡æ—¶å™¨å³ä¸ºåœæ­¢</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timer_remove(&amp;hello_timer);</span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>hello_send</code></p><ul><li>æ£€æµ‹å‘é€ Hello æ¶ˆæ¯æ˜¯å¦æœ‰å¿…è¦ï¼Œé€šè¿‡åˆ¤æ–­ <code>time_diff &gt;= HELLO_INTERVAL</code> ä»¥é˜²æˆ‘ä»¬å·²ç»åœ¨HELLO_INTERVALå†…å‘é€äº†å…¶ä»–å¹¿æ’­ä¿¡æ¯</li></ul></li><li><p><code>hello_process</code></p><ul><li><p>å¤„ç† Hello æ¶ˆæ¯æ—¶ï¼Œä»…éœ€è¦å­˜å‚¨ç›®çš„èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œä¸éœ€è¦å®Œæ•´çš„å››å…ƒç»„ã€‚åŒæ ·ç»è¿‡è·¯ç”±å‘ç°è¿‡ç¨‹ï¼Œå¹¶æ£€æµ‹æ˜¯å¦æœ‰è¡¥å……ä¿¡æ¯</p></li><li><p>é‚»å±…èŠ‚ç‚¹åº”è¯¥åªåœ¨æ”¶åˆ°3ä¸ªè¿ç»­çš„ Hello æ¶ˆæ¯åæ‰æœ‰æ•ˆ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (receive_n_hellos)</span><br><span class="line">    state = INVALID;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    state = VALID;</span><br></pre></td></tr></table></figure></li><li><p>åœ¨å¯¹æ—¶é—´çš„åˆ¤æ–­ä¸Šï¼ŒHello æ¶ˆæ¯çš„å¤„ç†ä¸ºå…è®¸çš„æ—¶å»¶ä¸å‘é€åŒ…çš„æ•°é‡ç›¸ä¹˜ååŠ å…¥è·¯ç”±çš„æ—¶å»¶</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timeout = ALLOWED_HELLO_LOSS * hello_interval + ROUTE_TIMEOUT_SLACK;</span><br></pre></td></tr></table></figure></li><li><p>æœ€åé€šè¿‡ <code>hello_update_timeout</code> æ›´æ–° timeout ä¿¡æ¯ï¼Œè€Œ <code>hello_update_timeout</code> å‡½æ•°è°ƒç”¨è®¡æ—¶å™¨çš„æ›´æ–°æ–¹æ³•</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timer_set_timeout(&amp;rt-&gt;hello_timer, time + HELLO_DELAY);</span><br></pre></td></tr></table></figure></li></ul></li></ul><hr><h2 id="RREP-ACK"><a href="#RREP-ACK" class="headerlink" title="RREP_ACK"></a><code>RREP_ACK</code></h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>                   <span class="number">1</span></span><br><span class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span> <span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span></span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|     Type      |   Reserved    |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></pre></td></tr></table></figure><hr><h2 id="å…³äº-tåç¼€"><a href="#å…³äº-tåç¼€" class="headerlink" title="å…³äº_tåç¼€"></a>å…³äº<code>_t</code>åç¼€</h2><blockquote><p>but most often you will use &lt;inttypes.h&gt; which (unusually for standard C headers) includes &lt;stdint.h&gt;. It (&lt;inttypes.h&gt;) also defines macros for use with the printf() and scanf().</p><p>As Matt Curtis noted, there is no significance to the compiler in the suffix; it is a human-oriented convention.</p><p>However, you should also note that POSIX defines a lot of extra type names ending in â€˜_tâ€™, and reserves the suffix for the implementation. That means that if you are working on POSIX-related systems, defining your own type names with the convention is ill-advised. The system I work on has done it (for more than 20 years); we regularly get tripped up by systems defining types with the same name as we define.</p><p>CesarB:</p><p>I use _type instead of _t on my typedefs precisely to avoid that.</p><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/231760/what-does-a-type-followed-by-t-underscore-t-represent">Reference</a></p></blockquote><p>æ¨æµ‹ AODV ä½œè€…æ„ä¸ºå¯¹æœ¬èº« <code>struct struct_name</code> çš„æ›¿æ¢ï¼Œä½¿å¾—æ‰€æœ‰ <code>struct_name_t</code> éƒ½ä¸ºå¯¹åº” <code>struct struct_name</code> çš„ <code>typedef</code>ï¼Œä½†æ˜¯æ ¹æ®ç½‘ä¸Šæ‰€æŸ¥é˜…çš„èµ„æ–™ï¼Œé™¤éå¯¹ç³»ç»Ÿå†…æ ¸ç­‰æœ‰æ·±å…¥äº†è§£ï¼Œå¯¹äºéå†…æ ¸çº§åˆ«ä»£ç å¹¶ä¸æ¨èè¿™æ ·å‘½åï¼Œå¯èƒ½ä¼šä¸ POSIX ç›¸å…³çš„ä»£ç èµ·å†²çª</p><hr>
          </div>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>Augists
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://augists.top/SELF/SHARING/STUDY/AODV-Source-Code-Analysis/" title="AODV Analysis">https://augists.top/SELF/SHARING/STUDY/AODV-Source-Code-Analysis/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/en" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>Welcome to my other publishing channels</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/Augists">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="http://wpa.qq.com/msgrd?v=3&uin=2057240784&site=qq&menu=yes">
            <span class="icon">
              <i class="fab fa-qq"></i>
            </span>

            <span class="label">QQ</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://github.com/Augists">
            <span class="icon">
              <i class="fab fa-github"></i>
            </span>

            <span class="label">GitHub</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://gitee.com/Augists">
            <span class="icon">
              <i class="fab fa-git-alt"></i>
            </span>

            <span class="label">Gitee</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://blog.csdn.net/qq_45910536">
            <span class="icon">
              <i class="fab fa-cuttlefish"></i>
            </span>

            <span class="label">CSDN</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://augists.top/subscribe">
            <span class="icon">
              <i class="fab fa-mailchimp"></i>
            </span>

            <span class="label">Subscribe</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/SHARING/" rel="tag"><i class="fa fa-tag"></i> SHARING</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/SELF/SHARING/STUDY/How-to-choose-your-own-courses-in-SSDUT/" rel="prev" title="How to Choose Your Own Courses in SSDUT">
      <i class="fa fa-chevron-left"></i> How to Choose Your Own Courses in SSDUT
    </a></div>
      <div class="post-nav-item">
    <a href="/SELF/SHARING/LIFE/Why-my-devices-cannot-automatically-connect-to-mbp/" rel="next" title="Why My Devices Cannot Automatically Connect to Mbp">
      Why My Devices Cannot Automatically Connect to Mbp <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  
  <div class="comments">
  <script src="https://utteranc.es/client.js" repo="Augists/comments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>
  </div>
  
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#AODV-%E5%8D%8F%E8%AE%AE%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%E5%8F%8A%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="nav-number">1.</span> <span class="nav-text">AODV åè®®åŸºæœ¬åŸç†åŠå·¥ä½œæµç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#AODV-%E7%AE%80%E4%BB%8B"><span class="nav-number">1.1.</span> <span class="nav-text">AODV ç®€ä»‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AODV-%E7%89%B9%E7%82%B9"><span class="nav-number">1.2.</span> <span class="nav-text">AODV ç‰¹ç‚¹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AODV-Message-Type"><span class="nav-number">1.3.</span> <span class="nav-text">AODV Message Type</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AODV-%E6%96%87%E4%BB%B6%E6%A0%91%E5%88%86%E6%9E%90"><span class="nav-number">1.4.</span> <span class="nav-text">AODV æ–‡ä»¶æ ‘åˆ†æ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#define-do-while-0"><span class="nav-number">1.5.</span> <span class="nav-text">#define do while (0)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#list-c"><span class="nav-number">1.6.</span> <span class="nav-text">list.c</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Log-Path"><span class="nav-number">1.7.</span> <span class="nav-text">Log Path</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#defs-h"><span class="nav-number">1.8.</span> <span class="nav-text">defs.h</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9-list-t-%E5%92%8C-timer-%E5%B5%8C%E5%A5%97%E7%BB%93%E6%9E%84%E4%BD%93%E7%9A%84%E7%90%86%E8%A7%A3"><span class="nav-number">1.9.</span> <span class="nav-text">å¯¹ list_t å’Œ timer åµŒå¥—ç»“æ„ä½“çš„ç†è§£</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#timeval-%E7%BB%93%E6%9E%84%E4%BD%93%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E4%B8%8D%E5%90%8C%E5%AE%9A%E4%B9%89"><span class="nav-number">1.10.</span> <span class="nav-text">timeval ç»“æ„ä½“åœ¨ä¸åŒç³»ç»Ÿä¸­çš„ä¸åŒå®šä¹‰</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#timer-queue-c"><span class="nav-number">1.11.</span> <span class="nav-text">timer_queue.c</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AODV-Socket"><span class="nav-number">1.12.</span> <span class="nav-text">AODV Socket</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RREQ"><span class="nav-number">1.13.</span> <span class="nav-text">RREQ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RREP"><span class="nav-number">1.14.</span> <span class="nav-text">RREP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RERR"><span class="nav-number">1.15.</span> <span class="nav-text">RERR</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HELLO"><span class="nav-number">1.16.</span> <span class="nav-text">HELLO</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RREP-ACK"><span class="nav-number">1.17.</span> <span class="nav-text">RREP_ACK</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E-t%E5%90%8E%E7%BC%80"><span class="nav-number">1.18.</span> <span class="nav-text">å…³äº_tåç¼€</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Augists"
      src="https://augists-upic.oss-cn-qingdao.aliyuncs.com/uPic/2CCC8E38-15C8-4A70-A836-2DC4D988DD4E_1_105_c.jpeg">
  <p class="site-author-name" itemprop="name">Augists</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">171</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">45</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://augists.top/subscribe" title="Subscribe â†’ https:&#x2F;&#x2F;augists.top&#x2F;subscribe"><i class="fab fa-mailchimp fa-fw"></i>Subscribe</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS â†’ &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/Augists" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;Augists" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:awzyc2010@163.com" title="E-Mail â†’ mailto:awzyc2010@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/484868244" title="Bilibili â†’ https:&#x2F;&#x2F;space.bilibili.com&#x2F;484868244" rel="noopener" target="_blank"><i class="fa fa-tv fa-fw"></i>Bilibili</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/Augists" title="Telegram â†’ https:&#x2F;&#x2F;t.me&#x2F;Augists" rel="noopener" target="_blank"><i class="fab fa-telegram fa-fw"></i>Telegram</a>
      </span>
  </div>

<a href="https://www.foreverblog.cn/go.html" target="_blank"> <img src="https://img.foreverblog.cn/wormhole_2.gif" alt="" style="width:auto;height:32px;" title="ç©¿æ¢­è™«æ´-éšæœºè®¿é—®åå¹´ä¹‹çº¦å‹é“¾åšå®¢"></a>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Augists</span>
</div>
  <div class="powered-by">
    <!--
    <i class="fa fa-user-md"></i><span id="busuanzi_container_site_pv">
      Click Number:<span id="busuanzi_value_site_pv"></span>æ¬¡
    </span>Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
    -->
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


  <!-- TODO -->
  <!-- åŠ¨æ€çº¿æ¡ -->
  <!--  -->

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"scale":1,"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":280,"height":300},"mobile":{"show":true,"scale":0.5},"log":false,"tagMode":false});</script></body>
</html>
